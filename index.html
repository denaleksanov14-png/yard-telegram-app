<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—ã–±–æ—Ä –æ–∫—Ä—É–≥–∞ –∏ —Ä–∞–π–æ–Ω–∞ –ú–æ—Å–∫–≤—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            color: #333;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .header {
            text-align: center;
            padding: 20px;
            color: white;
            background: rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .breadcrumb {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 14px;
        }
        
        .breadcrumb span {
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.3s;
            padding: 5px 10px;
            border-radius: 15px;
        }
        
        .breadcrumb span:hover {
            opacity: 1;
            background: rgba(255,255,255,0.1);
        }
        
        .breadcrumb .separator {
            margin: 0 8px;
            opacity: 0.6;
        }
        
        .breadcrumb .current {
            opacity: 1;
            font-weight: 600;
            background: rgba(255,255,255,0.2);
        }
        
        .content-container {
            flex: 1;
            background: white;
            border-radius: 25px 25px 0 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .search-container {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s;
            background: white;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ */
        .list-container {
            flex: 1;
            overflow-y: auto;
        }
        
        .list-section {
            margin-bottom: 5px;
        }
        
        .list-item {
            padding: 16px 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
        }
        
        .list-item:last-child {
            border-bottom: none;
        }
        
        .list-item:hover {
            background-color: #f8f9fa;
        }
        
        .list-item.selected {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
        }
        
        .item-emoji {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            flex-shrink: 0;
            font-size: 16px;
        }
        
        .area-item .item-emoji {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        }
        
        .item-content {
            flex: 1;
        }
        
        .item-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
            font-size: 15px;
        }
        
        .item-subtitle {
            font-size: 13px;
            color: #666;
        }
        
        .selected-indicator {
            width: 20px;
            height: 20px;
            border: 2px solid #ddd;
            border-radius: 50%;
            margin-left: 10px;
            flex-shrink: 0;
            transition: all 0.3s;
            position: relative;
        }
        
        .selected .selected-indicator {
            background: #2196f3;
            border-color: #2196f3;
        }
        
        .selected .selected-indicator::after {
            content: '‚úì';
            color: white;
            font-size: 12px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .buttons-container {
            padding: 15px 20px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
        }
        
        .btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:active {
            transform: scale(0.98);
        }
        
        .no-results {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            font-size: 14px;
        }
        
        .step {
            display: none;
            flex-direction: column;
            height: 100%;
        }
        
        .step.active {
            display: flex;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
        .list-container::-webkit-scrollbar {
            width: 4px;
        }
        
        .list-container::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .list-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 2px;
        }
        
        .list-container::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="mainTitle">üèôÔ∏è –í—ã–±–æ—Ä –æ–∫—Ä—É–≥–∞ –ú–æ—Å–∫–≤—ã</h1>
            <p id="mainSubtitle">–í—ã–±–µ—Ä–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –æ–∫—Ä—É–≥</p>
        </div>
        
        <div class="breadcrumb" id="breadcrumb">
            <span class="current">–û–∫—Ä—É–≥</span>
        </div>
        
        <div class="content-container">
            <!-- –®–∞–≥ 1: –í—ã–±–æ—Ä –æ–∫—Ä—É–≥–∞ -->
            <div class="step active" id="stepDistricts">
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="searchDistricts" placeholder="–ü–æ–∏—Å–∫ –æ–∫—Ä—É–≥–∞..." />
                        <div class="search-icon">üîç</div>
                    </div>
                    </div>
                
                <div class="list-container" id="districtsListContainer">
                    <div id="districtsList">
                        <!-- –°–ø–∏—Å–æ–∫ –æ–∫—Ä—É–≥–æ–≤ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∑–¥–µ—Å—å -->
                    </div>
                </div>
                
                <div class="buttons-container">
                    <button class="btn btn-primary" id="nextBtn" disabled>
                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                    </button>
                </div>
            </div>
            
            <!-- –®–∞–≥ 2: –í—ã–±–æ—Ä —Ä–∞–π–æ–Ω–∞ -->
            <div class="step" id="stepAreas">
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="searchAreas" placeholder="–ü–æ–∏—Å–∫ —Ä–∞–π–æ–Ω–∞..." />
                        <div class="search-icon">üîç</div>
                    </div>
                </div>
                
                <div class="list-container" id="areasListContainer">
                    <div id="areasList">
                        <!-- –°–ø–∏—Å–æ–∫ —Ä–∞–π–æ–Ω–æ–≤ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∑–¥–µ—Å—å -->
                    </div>
                </div>
                
                <div class="buttons-container">
                    <button class="btn btn-secondary" id="backBtn">
                        –ù–∞–∑–∞–¥
                    </button>
                    <button class="btn btn-primary" id="confirmBtn" disabled>
                        –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –æ–∫—Ä—É–≥–æ–≤ –ú–æ—Å–∫–≤—ã —Å —Ä–∞–π–æ–Ω–∞–º–∏
        const moscowData = [
            { 
                id: 1, 
                name: "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –æ–∫—Ä—É–≥", 
                emoji: "üèõÔ∏è",
                areas: [
                    { id: 101, name: "–ê—Ä–±–∞—Ç" },
                    { id: 102, name: "–ë–∞—Å–º–∞–Ω–Ω—ã–π" },
                    { id: 103, name: "–ó–∞–º–æ—Å–∫–≤–æ—Ä–µ—á—å–µ" },
                    { id: 104, name: "–ö—Ä–∞—Å–Ω–æ—Å–µ–ª—å—Å–∫–∏–π" },
                    { id: 105, name: "–ú–µ—â–∞–Ω—Å–∫–∏–π" },
                    { id: 106, name: "–ü—Ä–µ—Å–Ω–µ–Ω—Å–∫–∏–π" },
                    { id: 107, name: "–¢–∞–≥–∞–Ω—Å–∫–∏–π" },
                    { id: 108, name: "–¢–≤–µ—Ä—Å–∫–æ–π" },
                    { id: 109, name: "–•–∞–º–æ–≤–Ω–∏–∫–∏" },
                    { id: 110, name: "–Ø–∫–∏–º–∞–Ω–∫–∞" }
                ]
            },
            { 
                id: 2, 
                name: "–°–µ–≤–µ—Ä–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –æ–∫—Ä—É–≥", 
                emoji: "üå≤",
                areas: [
                    { id: 201, name: "–ê—ç—Ä–æ–ø–æ—Ä—Ç" },
                    { id: 202, name: "–ë–µ–≥–æ–≤–æ–π" },
                    { id: 203, name: "–ë–µ—Å–∫—É–¥–Ω–∏–∫–æ–≤—Å–∫–∏–π" },
                    { id: 204, name: "–í–æ–π–∫–æ–≤—Å–∫–∏–π" },
                    { id: 205, name: "–í–æ—Å—Ç–æ—á–Ω–æ–µ –î–µ–≥—É–Ω–∏–Ω–æ" },
                    { id: 206, name: "–ì–æ–ª–æ–≤–∏–Ω—Å–∫–∏–π" },
                    { id: 207, name: "–î–º–∏—Ç—Ä–æ–≤—Å–∫–∏–π" },
                    { id: 208, name: "–ó–∞–ø–∞–¥–Ω–æ–µ –î–µ–≥—É–Ω–∏–Ω–æ" },
                    { id: 209, name: "–ö–æ–ø—Ç–µ–≤–æ" },
                    { id: 210, name: "–õ–µ–≤–æ–±–µ—Ä–µ–∂–Ω—ã–π" },
                    { id: 211, name: "–ú–æ–ª–∂–∞–Ω–∏–Ω–æ–≤—Å–∫–∏–π" },
                    { id: 212, name: "–°–∞–≤—ë–ª–æ–≤—Å–∫–∏–π" },
                    { id: 213, name: "–°–æ–∫–æ–ª" },
                    { id: 214, name: "–¢–∏–º–∏—Ä—è–∑–µ–≤—Å–∫–∏–π" },
                    { id: 215, name: "–•–æ–≤—Ä–∏–Ω–æ" },
                    { id: 216, name: "–•–æ—Ä–æ—à—ë–≤—Å–∫–∏–π" }
                ]
            },
            { 
                id: 3, 
                name: "–°–µ–≤–µ—Ä–æ-–í–æ—Å—Ç–æ—á–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –æ–∫—Ä—É–≥", 
                emoji: "üèòÔ∏è",
                areas: [
                    { id: 301, name: "–ê–ª–µ–∫—Å–µ–µ–≤—Å–∫–∏–π" },
                    { id: 302, name: "–ê–ª—Ç—É—Ñ—å–µ–≤—Å–∫–∏–π" },
                    { id: 303, name: "–ë–∞–±—É—à–∫–∏–Ω—Å–∫–∏–π" },
                    { id: 304, name: "–ë–∏–±–∏—Ä–µ–≤–æ" },
                    { id: 305, name: "–ë—É—Ç—ã—Ä—Å–∫–∏–π" },
                    { id: 306, name: "–õ–∏–∞–Ω–æ–∑–æ–≤–æ" },
                    { id: 307, name: "–õ–æ—Å–∏–Ω–æ–æ—Å—Ç—Ä–æ–≤—Å–∫–∏–π" },
                    { id: 308, name: "–ú–∞—Ä—Ñ–∏–Ω–æ" },
                    { id: 309, name: "–ú–∞—Ä—å–∏–Ω–∞ –†–æ—â–∞" },
                    { id: 310, name: "–û—Å—Ç–∞–Ω–∫–∏–Ω—Å–∫–∏–π" },
                    { id: 311, name: "–û—Ç—Ä–∞–¥–Ω–æ–µ" },
                    { id: 312, name: "–†–æ—Å—Ç–æ–∫–∏–Ω–æ" },
                    { id: 313, name: "–°–≤–∏–±–ª–æ–≤–æ" },
                    { id: 314, name: "–°–µ–≤–µ—Ä–Ω—ã–π" },
                    { id: 315, name: "–°–µ–≤–µ—Ä–Ω–æ–µ –ú–µ–¥–≤–µ–¥–∫–æ–≤–æ" },
                    { id: 316, name: "–Æ–∂–Ω–æ–µ –ú–µ–¥–≤–µ–¥–∫–æ–≤–æ" },
                    { id: 317, name: "–Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∏–π" }
                ]
            },
            { 
                id: 4, 
                name: "–í–æ—Å—Ç–æ—á–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –æ–∫—Ä—É–≥", 
                emoji: "üåÖ",
                areas: [
                    { id: 401, name: "–ë–æ–≥–æ—Ä–æ–¥—Å–∫–æ–µ" },
                    { id: 402, name: "–í–µ—à–Ω—è–∫–∏" },
                    { id: 403, name: "–í–æ—Å—Ç–æ—á–Ω–æ–µ –ò–∑–º–∞–π–ª–æ–≤–æ" },
                    { id: 404, name: "–í–æ—Å—Ç–æ—á–Ω—ã–π" },
                    { id: 405, name: "–ì–æ–ª—å—è–Ω–æ–≤–æ" },
                    { id: 406, name: "–ò–≤–∞–Ω–æ–≤—Å–∫–æ–µ" },
                    { id: 407, name: "–ò–∑–º–∞–π–ª–æ–≤–æ" },
                    { id: 408, name: "–ö–æ—Å–∏–Ω–æ-–£—Ö—Ç–æ–º—Å–∫–∏–π" },
                    { id: 409, name: "–ú–µ—Ç—Ä–æ–≥–æ—Ä–æ–¥–æ–∫" },
                    { id: 410, name: "–ù–æ–≤–æ–≥–∏—Ä–µ–µ–≤–æ" },
                    { id: 411, name: "–ù–æ–≤–æ–∫–æ—Å–∏–Ω–æ" },
                    { id: 412, name: "–ü–µ—Ä–æ–≤–æ" },
                    { id: 413, name: "–ü—Ä–µ–æ–±—Ä–∞–∂–µ–Ω—Å–∫–æ–µ" },
                    { id: 414, name: "–°–µ–≤–µ—Ä–Ω–æ–µ –ò–∑–º–∞–π–ª–æ–≤–æ" },
                    { id: 415, name: "–°–æ–∫–æ–ª–∏–Ω–∞—è –ì–æ—Ä–∞" },
                    { id: 416, name: "–°–æ–∫–æ–ª—å–Ω–∏–∫–∏" }
                ]
            },
            { 
                id: 5, 
                name: "–Æ–≥–æ-–í–æ—Å—Ç–æ—á–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –æ–∫—Ä—É–≥", 
                emoji: "üè≠",
                areas: [
                    { id: 501, name: "–í—ã—Ö–∏–Ω–æ-–ñ—É–ª–µ–±–∏–Ω–æ" },
                    { id: 502, name: "–ö–∞–ø–æ—Ç–Ω—è" },
                    { id: 503, name: "–ö—É–∑—å–º–∏–Ω–∫–∏" },
                    { id: 504, name: "–õ–µ—Ñ–æ—Ä—Ç–æ–≤–æ" },
                    { id: 505, name: "–õ—é–±–ª–∏–Ω–æ" },
                    { id: 506, name: "–ú–∞—Ä—å–∏–Ω–æ" },
                    { id: 507, name: "–ù–µ–∫—Ä–∞—Å–æ–≤–∫–∞" },
                    { id: 508, name: "–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∏–π" },
                    { id: 509, name: "–ü–µ—á–∞—Ç–Ω–∏–∫–∏" },
                    { id: 510, name: "–†—è–∑–∞–Ω—Å–∫–∏–π" },
                    { id: 511, name: "–¢–µ–∫—Å—Ç–∏–ª—å—â–∏–∫–∏" },
                    { id: 512, name: "–Æ–∂–Ω–æ–ø–æ—Ä—Ç–æ–≤—ã–π" }
                ]
            },
            { 
                id: 6, 
                name: "–Æ–∂–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –æ–∫—Ä—É–≥", 
                emoji: "üåá",
                areas: [
                    { id: 601, name: "–ë–∏—Ä—é–ª—ë–≤–æ –í–æ—Å—Ç–æ—á–Ω–æ–µ" },
                    { id: 602, name: "–ë–∏—Ä—é–ª—ë–≤–æ –ó–∞–ø–∞–¥–Ω–æ–µ" },
                    { id: 603, name: "–ë—Ä–∞—Ç–µ–µ–≤–æ" },
                    { id: 604, name: "–î–∞–Ω–∏–ª–æ–≤—Å–∫–∏–π" },
                    { id: 605, name: "–î–æ–Ω—Å–∫–æ–π" },
                    { id: 606, name: "–ó—è–±–ª–∏–∫–æ–≤–æ" },
                    { id: 607, name: "–ú–æ—Å–∫–≤–æ—Ä–µ—á—å–µ-–°–∞–±—É—Ä–æ–≤–æ" },
                    { id: 608, name: "–ù–∞–≥–∞—Ç–∏–Ω–æ-–°–∞–¥–æ–≤–Ω–∏–∫–∏" },
                    { id: 609, name: "–ù–∞–≥–∞—Ç–∏–Ω—Å–∫–∏–π –ó–∞—Ç–æ–Ω" },
                    { id: 610, name: "–ù–∞–≥–æ—Ä–Ω—ã–π" },
                    { id: 611, name: "–û—Ä–µ—Ö–æ–≤–æ-–ë–æ—Ä–∏—Å–æ–≤–æ –°–µ–≤–µ—Ä–Ω–æ–µ" },
                    { id: 612, name: "–û—Ä–µ—Ö–æ–≤–æ-–ë–æ—Ä–∏—Å–æ–≤–æ –Æ–∂–Ω–æ–µ" },
                    { id: 613, name: "–¶–∞—Ä–∏—Ü—ã–Ω–æ" },
                    { id: 614, name: "–ß–µ—Ä—Ç–∞–Ω–æ–≤–æ –°–µ–≤–µ—Ä–Ω–æ–µ" },
                    { id: 615, name: "–ß–µ—Ä—Ç–∞–Ω–æ–≤–æ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ" },
                    { id: 616, name: "–ß–µ—Ä—Ç–∞–Ω–æ–≤–æ –Æ–∂–Ω–æ–µ" }
                ]
            },
            { 
                id: 7, 
                name: "–Æ–≥–æ-–ó–∞–ø–∞–¥–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –æ–∫—Ä—É–≥", 
                emoji: "üéì",
                areas: [
                    { id: 701, name: "–ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π" },
                    { id: 702, name: "–ì–∞–≥–∞—Ä–∏–Ω—Å–∫–∏–π" },
                    { id: 703, name: "–ó—é–∑–∏–Ω–æ" },
                    { id: 704, name: "–ö–æ–Ω—å–∫–æ–≤–æ" },
                    { id: 705, name: "–ö–æ—Ç–ª–æ–≤–∫–∞" },
                    { id: 706, name: "–õ–æ–º–æ–Ω–æ—Å–æ–≤—Å–∫–∏–π" },
                    { id: 707, name: "–û–±—Ä—É—á–µ–≤—Å–∫–∏–π" },
                    { id: 708, name: "–°–µ–≤–µ—Ä–Ω–æ–µ –ë—É—Ç–æ–≤–æ" },
                    { id: 709, name: "–¢—ë–ø–ª—ã–π –°—Ç–∞–Ω" },
                    { id: 710, name: "–ß–µ—Ä—ë–º—É—à–∫–∏" },
                    { id: 711, name: "–Æ–∂–Ω–æ–µ –ë—É—Ç–æ–≤–æ" },
                    { id: 712, name: "–Ø—Å–µ–Ω–µ–≤–æ" }
                ]
            },
            { 
                id: 8, 
                name: "–ó–∞–ø–∞–¥–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –æ–∫—Ä—É–≥", 
                emoji: "üíº",
                areas: [
                    { id: 801, name: "–í–Ω—É–∫–æ–≤–æ" },
                    { id: 802, name: "–î–æ—Ä–æ–≥–æ–º–∏–ª–æ–≤–æ" },
                    { id: 803, name: "–ö—Ä—ã–ª–∞—Ç—Å–∫–æ–µ" },
                    { id: 804, name: "–ö—É–Ω—Ü–µ–≤–æ" },
                    { id: 805, name: "–ú–æ–∂–∞–π—Å–∫–∏–π" },
                    { id: 806, name: "–ù–æ–≤–æ-–ü–µ—Ä–µ–¥–µ–ª–∫–∏–Ω–æ" },
                    { id: 807, name: "–û—á–∞–∫–æ–≤–æ-–ú–∞—Ç–≤–µ–µ–≤—Å–∫–æ–µ" },
                    { id: 808, name: "–ü—Ä–æ—Å–ø–µ–∫—Ç –í–µ—Ä–Ω–∞–¥—Å–∫–æ–≥–æ" },
                    { id: 809, name: "–†–∞–º–µ–Ω–∫–∏" },
                    { id: 810, name: "–°–æ–ª–Ω—Ü–µ–≤–æ" },
                    { id: 811, name: "–¢—Ä–æ–ø–∞—Ä—ë–≤–æ-–ù–∏–∫—É–ª–∏–Ω–æ" },
                    { id: 812, name: "–§–∏–ª—ë–≤—Å–∫–∏–π –ü–∞—Ä–∫" },
                    { id: 813, name: "–§–∏–ª–∏-–î–∞–≤—ã–¥–∫–æ–≤–æ" }
                ]
            },
            { 
                id: 9, 
                name: "–°–µ–≤–µ—Ä–æ-–ó–∞–ø–∞–¥–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –æ–∫—Ä—É–≥", 
                emoji: "üèûÔ∏è",
                areas: [
                    { id: 901, name: "–ö—É—Ä–∫–∏–Ω–æ" },
                    { id: 902, name: "–ú–∏—Ç–∏–Ω–æ" },
                    { id: 903, name: "–ü–æ–∫—Ä–æ–≤—Å–∫–æ–µ-–°—Ç—Ä–µ—à–Ω–µ–≤–æ" },
                    { id: 904, name: "–°–µ–≤–µ—Ä–Ω–æ–µ –¢—É—à–∏–Ω–æ" },
                    { id: 905, name: "–°—Ç—Ä–æ–≥–∏–Ω–æ" },
                    { id: 906, name: "–•–æ—Ä–æ—à—ë–≤–æ-–ú–Ω—ë–≤–Ω–∏–∫–∏" },
                    { id: 907, name: "–©—É–∫–∏–Ω–æ" },
                    { id: 908, name: "–Æ–∂–Ω–æ–µ –¢—É—à–∏–Ω–æ" }
                ]
            },
            { 
                id: 10, 
                name: "–ó–µ–ª–µ–Ω–æ–≥—Ä–∞–¥—Å–∫–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –æ–∫—Ä—É–≥", 
                emoji: "üå≥",
                areas: [
                    { id: 1001, name: "–ö—Ä—é–∫–æ–≤–æ" },
                    { id: 1002, name: "–ú–∞—Ç—É—à–∫–∏–Ω–æ" },
                    { id: 1003, name: "–°–∞–≤–µ–ª–∫–∏" },
                    { id: 1004, name: "–°–∏–ª–∏–Ω–æ" },
                    { id: 1005, name: "–°—Ç–∞—Ä–æ–µ –ö—Ä—é–∫–æ–≤–æ" }
                ]
            }
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let currentStep = 'districts';
        let selectedDistrict = null;
        let selectedArea = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            renderDistricts(moscowData);
            setupEventListeners();
            updateBreadcrumb();
        }

        // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ –æ–∫—Ä—É–≥–æ–≤
        function renderDistricts(districtsToRender) {
            const container = document.getElementById('districtsList');
            
            if (districtsToRender.length === 0) {
                container.innerHTML = '<div class="no-results">–û–∫—Ä—É–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω</div>';
                return;
            }
            
            container.innerHTML = districtsToRender.map(district => `
                <div class="list-item" data-id="${district.id}">
                    <div class="item-emoji">${district.emoji}</div>
                    <div class="item-content">
                        <div class="item-title">${district.name}</div>
                        <div class="item-subtitle">${district.areas.length} —Ä–∞–π–æ–Ω–æ–≤</div>
                    </div>
                    <div class="selected-indicator"></div>
                </div>
            `).join('');
            
            reattachDistrictListeners();
        }

        // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ —Ä–∞–π–æ–Ω–æ–≤
        function renderAreas(areasToRender) {
            const container = document.getElementById('areasList');
            
            if (areasToRender.length === 0) {
                container.innerHTML = '<div class="no-results">–†–∞–π–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω</div>';
                return;
            }
            
            container.innerHTML = areasToRender.map(area => `
            <div class="list-item area-item" data-id="${area.id}">
                    <div class="item-emoji">üèòÔ∏è</div>
                    <div class="item-content">
                        <div class="item-title">${area.name}</div>
                    </div>
                    <div class="selected-indicator"></div>
                </div>
            `).join('');
            
            reattachAreaListeners();
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —à–∞–≥–æ–≤
        function goToStep(step) {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById(`step${step.charAt(0).toUpperCase() + step.slice(1)}`).classList.add('active');
            currentStep = step;
            updateBreadcrumb();
            updateHeader();
            updateButtons();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ö–ª–µ–±–Ω—ã—Ö –∫—Ä–æ—à–µ–∫
        function updateBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            
            if (currentStep === 'districts') {
                breadcrumb.innerHTML = '<span class="current">–û–∫—Ä—É–≥</span>';
            } else {
                breadcrumb.innerHTML = `
                    <span onclick="goToStep('districts')">–û–∫—Ä—É–≥</span>
                    <span class="separator">‚Ä∫</span>
                    <span class="current">${selectedDistrict.name}</span>
                `;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
        function updateHeader() {
            const title = document.getElementById('mainTitle');
            const subtitle = document.getElementById('mainSubtitle');
            
            if (currentStep === 'districts') {
                title.textContent = 'üèôÔ∏è –í—ã–±–æ—Ä –æ–∫—Ä—É–≥–∞ –ú–æ—Å–∫–≤—ã';
                subtitle.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –æ–∫—Ä—É–≥';
            } else {
                title.textContent = üèòÔ∏è ${selectedDistrict.name};
                subtitle.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–π–æ–Ω';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
        function updateButtons() {
            const nextBtn = document.getElementById('nextBtn');
            const confirmBtn = document.getElementById('confirmBtn');
            
            if (currentStep === 'districts') {
                nextBtn.disabled = !selectedDistrict;
                nextBtn.textContent = selectedDistrict ? –í—ã–±—Ä–∞—Ç—å: ${selectedDistrict.name} : '–í—ã–±–µ—Ä–∏—Ç–µ –æ–∫—Ä—É–≥';
            } else {
                confirmBtn.disabled = !selectedArea;
                confirmBtn.textContent = selectedArea ? –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å: ${selectedArea.name} : '–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–π–æ–Ω';
            }
        }

        // –í—ã–±–æ—Ä –æ–∫—Ä—É–≥–∞
        function selectDistrict(districtId) {
            selectedDistrict = moscowData.find(d => d.id === districtId);
            
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            document.querySelectorAll('.list-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
            const selectedElement = document.querySelector(`.list-item[data-id="${districtId}"]`);
            if (selectedElement) {
                selectedElement.classList.add('selected');
            }
            
            updateButtons();
        }

        // –í—ã–±–æ—Ä —Ä–∞–π–æ–Ω–∞
        function selectArea(areaId) {
            selectedArea = selectedDistrict.areas.find(a => a.id === areaId);
            
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            document.querySelectorAll('.area-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
            const selectedElement = document.querySelector(`.area-item[data-id="${areaId}"]`);
            if (selectedElement) {
                selectedElement.classList.add('selected');
            }
            
            updateButtons();
        }

        // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
        function goToNextStep() {
            if (currentStep === 'districts' && selectedDistrict) {
                renderAreas(selectedDistrict.areas);
                goToStep('areas');
                selectedArea = null;
                updateButtons();
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∏—Å–∫ —Ä–∞–π–æ–Ω–æ–≤
                document.getElementById('searchAreas').value = '';
            }
        }

        // –í–æ–∑–≤—Ä–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —à–∞–≥—É
        function goToPreviousStep() {
            if (currentStep === 'areas') {
                goToStep('districts');
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∏—Å–∫ –æ–∫—Ä—É–≥–æ–≤
                document.getElementById('searchDistricts').value = '';
                renderDistricts(moscowData);
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±–æ—Ä –æ–∫—Ä—É–≥–∞
                if (selectedDistrict) {
                    const selectedElement = document.querySelector(`.list-item[data-id="${selectedDistrict.id}"]`);
                    if (selectedElement) {
                        selectedElement.classList.add('selected');
                    }
                }
            }
        }

        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞
        function confirmSelection() {
            if (selectedDistrict && selectedArea) {
                // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram
                tg.sendData(JSON.stringify({
                    action: 'moscow_location_selected',
                    district: {
                        id: selectedDistrict.id,
                        name: selectedDistrict.name,
                        emoji: selectedDistrict.emoji
                    },
                    area: {
                        id: selectedArea.id,
                        name: selectedArea.name
                    }
                }));
                
                tg.showConfirm(`‚úÖ –í—ã–±–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω!\n${selectedDistrict.emoji} ${selectedDistrict.name}\nüèòÔ∏è ${selectedArea.name}`, (confirmed) => {
                    tg.close();
                });
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        function reattachDistrictListeners() {
            document.querySelectorAll('.list-item[data-id]').forEach(item => {
                item.addEventListener('click', function() {
                    selectDistrict(parseInt(this.dataset.id));
                });
            });
        }

        function reattachAreaListeners() {
            document.querySelectorAll('.area-item').forEach(item => {
                item.addEventListener('click', function() {
                    selectArea(parseInt(this.dataset.id));
                });
            });
        }

        function setupEventListeners() {
            // –ü–æ–∏—Å–∫ –æ–∫—Ä—É–≥–æ–≤
            document.getElementById('searchDistricts').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = moscowData.filter(district => 
                    district.name.toLowerCase().includes(searchTerm)
                );
                renderDistricts(filtered);
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±–æ—Ä –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å –≤ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–æ–º —Å–ø–∏—Å–∫–µ
                if (selectedDistrict && filtered.find(d => d.id === selectedDistrict.id)) {
                    const selectedElement = document.querySelector(`.list-item[data-id="${selectedDistrict.id}"]`);
                    if (selectedElement) {
                        selectedElement.classList.add('selected');
                    }
                }
            });

            // –ü–æ–∏—Å–∫ —Ä–∞–π–æ–Ω–æ–≤
            document.getElementById('searchAreas').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = selectedDistrict.areas.filter(area => 
                    area.name.toLowerCase().includes(searchTerm)
                );
                renderAreas(filtered);
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±–æ—Ä –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å –≤ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–æ–º —Å–ø–∏—Å–∫–µ
                if (selectedArea && filtered.find(a => a.id === selectedArea.id)) {
                    const selectedElement = document.querySelector(`.area-item[data-id="${selectedArea.
                                                                                          id}"]`);
                    if (selectedElement) {
                        selectedElement.classList.add('selected');
                    }
                }
            });

            // –ö–Ω–æ–ø–∫–∏
            document.getElementById('nextBtn').addEventListener('click', goToNextStep);
            document.getElementById('backBtn').addEventListener('click', goToPreviousStep);
            document.getElementById('confirmBtn').addEventListener('click', confirmSelection);
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
